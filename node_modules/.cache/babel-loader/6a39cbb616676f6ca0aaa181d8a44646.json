{"ast":null,"code":"import _styled from \"styled-components\";\nvar _jsxFileName = \"/Users/fabianmolina/Documents/1hive/tulip-frontend/src/components/Account/AccountModule.js\";\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useWallet } from 'use-wallet';\nimport { Button, GU, IconConnect, useViewport } from '@1hive/1hive-ui';\nimport AccountButton from './AccountButton';\nimport AccountPopover from './AccountPopover';\nimport ScreenConnected from './ScreenConnected';\nimport ScreenConnecting from './ScreenConnecting';\nimport ScreenError from './ScreenError';\nimport ScreenProviders from './ScreenProviders';\nconst SCREENS = [{\n  id: 'providers',\n  title: 'Use account from'\n}, {\n  id: 'connecting',\n  title: 'Use account from'\n}, {\n  id: 'connected',\n  title: 'Active account'\n}, {\n  id: 'error',\n  title: 'Connection error'\n}];\n\nvar _StyledDiv = _styled(\"div\").withConfig({\n  displayName: \"AccountModule___StyledDiv\",\n  componentId: \"sc-15uzi7u-0\"\n})([\"display:flex;align-items:center;justify-content:space-around;width:\", \";outline:0;\"], p => p._css);\n\nfunction AccountModule() {\n  const [opened, setOpened] = useState(false);\n  const [activatingDelayed, setActivatingDelayed] = useState(null);\n  const buttonRef = useRef();\n  const {\n    below\n  } = useViewport();\n  const compactMode = below('medium');\n  const wallet = useWallet();\n  const {\n    account,\n    connector,\n    error,\n    status\n  } = wallet;\n  const open = useCallback(() => setOpened(true), []);\n  const toggle = useCallback(() => setOpened(opened => !opened), []);\n  useEffect(() => {\n    let timer;\n\n    if (status === 'error') {\n      setActivatingDelayed(null);\n    }\n\n    if (status === 'connecting') {\n      setActivatingDelayed(connector);\n      timer = setTimeout(() => {\n        setActivatingDelayed(null);\n      }, 400);\n    }\n\n    return () => clearTimeout(timer);\n  }, [connector, status]);\n  const handleResetConnection = useCallback(() => {\n    wallet.reset();\n  }, [wallet]);\n  const handleActivate = useCallback(providerId => wallet.connect(providerId), [wallet]);\n  const previousScreenIndex = useRef(-1);\n  const {\n    screenIndex,\n    direction\n  } = useMemo(() => {\n    const screenId = status === 'disconnected' ? 'providers' : status;\n    const screenIndex = SCREENS.findIndex(screen => screen.id === screenId);\n    const direction = previousScreenIndex.current > screenIndex ? -1 : 1;\n    previousScreenIndex.current = screenIndex;\n    return {\n      direction,\n      screenIndex\n    };\n  }, [status]);\n  const screen = SCREENS[screenIndex];\n  const screenId = screen.id;\n  const handlePopoverClose = useCallback(() => {\n    if (screenId === 'connecting' || screenId === 'error') {\n      // reject closing the popover\n      return false;\n    }\n\n    setOpened(false);\n  }, [screenId]);\n  return /*#__PURE__*/React.createElement(_StyledDiv, {\n    ref: buttonRef,\n    tabIndex: \"0\",\n    _css: compactMode ? 'auto' : `${14 * GU}px`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 5\n    }\n  }, screen.id === 'connected' ? /*#__PURE__*/React.createElement(AccountButton, {\n    onClick: toggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }\n  }) : /*#__PURE__*/React.createElement(Button, {\n    icon: /*#__PURE__*/React.createElement(IconConnect, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }\n    }),\n    label: \"Connect account\",\n    onClick: toggle,\n    display: compactMode ? 'icon' : 'all',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(AccountPopover, {\n    direction: direction,\n    heading: screen.title,\n    keys: ({\n      screenId\n    }) => screenId + status + error.name,\n    onClose: handlePopoverClose,\n    onOpen: open,\n    opener: buttonRef.current,\n    screenId: screenId,\n    screenData: {\n      account,\n      activating: activatingDelayed,\n      activationError: error,\n      status,\n      screenId\n    },\n    screenKey: ({\n      account,\n      activating,\n      activationError,\n      screenId\n    }) => (activationError ? activationError.name : '') + account + activating + screenId,\n    visible: opened,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }\n  }, ({\n    activating,\n    activationError,\n    screenId\n  }) => {\n    if (screenId === 'connecting') {\n      return /*#__PURE__*/React.createElement(ScreenConnecting, {\n        providerId: activating,\n        onCancel: handleResetConnection,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 15\n        }\n      });\n    }\n\n    if (screenId === 'connected') {\n      return /*#__PURE__*/React.createElement(ScreenConnected, {\n        wallet: wallet,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 20\n        }\n      });\n    }\n\n    if (screenId === 'error') {\n      return /*#__PURE__*/React.createElement(ScreenError, {\n        error: activationError,\n        onBack: handleResetConnection,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 15\n        }\n      });\n    }\n\n    return /*#__PURE__*/React.createElement(ScreenProviders, {\n      onActivate: handleActivate,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 18\n      }\n    });\n  }));\n}\n\nexport default AccountModule;","map":{"version":3,"sources":["/Users/fabianmolina/Documents/1hive/tulip-frontend/src/components/Account/AccountModule.js"],"names":["React","useCallback","useEffect","useMemo","useRef","useState","useWallet","Button","GU","IconConnect","useViewport","AccountButton","AccountPopover","ScreenConnected","ScreenConnecting","ScreenError","ScreenProviders","SCREENS","id","title","AccountModule","opened","setOpened","activatingDelayed","setActivatingDelayed","buttonRef","below","compactMode","wallet","account","connector","error","status","open","toggle","timer","setTimeout","clearTimeout","handleResetConnection","reset","handleActivate","providerId","connect","previousScreenIndex","screenIndex","direction","screenId","findIndex","screen","current","handlePopoverClose","name","activating","activationError"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react'\r\nimport { useWallet } from 'use-wallet'\r\nimport { Button, GU, IconConnect, useViewport } from '@1hive/1hive-ui'\r\nimport AccountButton from './AccountButton'\r\nimport AccountPopover from './AccountPopover'\r\nimport ScreenConnected from './ScreenConnected'\r\nimport ScreenConnecting from './ScreenConnecting'\r\nimport ScreenError from './ScreenError'\r\nimport ScreenProviders from './ScreenProviders'\r\n\r\nconst SCREENS = [\r\n  { id: 'providers', title: 'Use account from' },\r\n  { id: 'connecting', title: 'Use account from' },\r\n  { id: 'connected', title: 'Active account' },\r\n  { id: 'error', title: 'Connection error' },\r\n]\r\n\r\nfunction AccountModule() {\r\n  const [opened, setOpened] = useState(false)\r\n  const [activatingDelayed, setActivatingDelayed] = useState(null)\r\n  const buttonRef = useRef()\r\n  const { below } = useViewport()\r\n  const compactMode = below('medium')\r\n  const wallet = useWallet()\r\n  const { account, connector, error, status } = wallet\r\n\r\n  const open = useCallback(() => setOpened(true), [])\r\n  const toggle = useCallback(() => setOpened(opened => !opened), [])\r\n\r\n  useEffect(() => {\r\n    let timer\r\n\r\n    if (status === 'error') {\r\n      setActivatingDelayed(null)\r\n    }\r\n\r\n    if (status === 'connecting') {\r\n      setActivatingDelayed(connector)\r\n      timer = setTimeout(() => {\r\n        setActivatingDelayed(null)\r\n      }, 400)\r\n    }\r\n\r\n    return () => clearTimeout(timer)\r\n  }, [connector, status])\r\n\r\n  const handleResetConnection = useCallback(() => {\r\n    wallet.reset()\r\n  }, [wallet])\r\n\r\n  const handleActivate = useCallback(providerId => wallet.connect(providerId), [\r\n    wallet,\r\n  ])\r\n\r\n  const previousScreenIndex = useRef(-1)\r\n\r\n  const { screenIndex, direction } = useMemo(() => {\r\n    const screenId = status === 'disconnected' ? 'providers' : status\r\n\r\n    const screenIndex = SCREENS.findIndex(screen => screen.id === screenId)\r\n    const direction = previousScreenIndex.current > screenIndex ? -1 : 1\r\n\r\n    previousScreenIndex.current = screenIndex\r\n\r\n    return { direction, screenIndex }\r\n  }, [status])\r\n\r\n  const screen = SCREENS[screenIndex]\r\n  const screenId = screen.id\r\n\r\n  const handlePopoverClose = useCallback(() => {\r\n    if (screenId === 'connecting' || screenId === 'error') {\r\n      // reject closing the popover\r\n      return false\r\n    }\r\n    setOpened(false)\r\n  }, [screenId])\r\n\r\n  return (\r\n    <div\r\n      ref={buttonRef}\r\n      tabIndex=\"0\"\r\n      css={`\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-around;\r\n        width: ${compactMode ? 'auto' : `${14 * GU}px`};\r\n        outline: 0;\r\n      `}\r\n    >\r\n      {screen.id === 'connected' ? (\r\n        <AccountButton onClick={toggle} />\r\n      ) : (\r\n        <Button\r\n          icon={<IconConnect />}\r\n          label=\"Connect account\"\r\n          onClick={toggle}\r\n          display={compactMode ? 'icon' : 'all'}\r\n        />\r\n      )}\r\n      <AccountPopover\r\n        direction={direction}\r\n        heading={screen.title}\r\n        keys={({ screenId }) => screenId + status + error.name}\r\n        onClose={handlePopoverClose}\r\n        onOpen={open}\r\n        opener={buttonRef.current}\r\n        screenId={screenId}\r\n        screenData={{\r\n          account,\r\n          activating: activatingDelayed,\r\n          activationError: error,\r\n          status,\r\n          screenId,\r\n        }}\r\n        screenKey={({ account, activating, activationError, screenId }) =>\r\n          (activationError ? activationError.name : '') +\r\n          account +\r\n          activating +\r\n          screenId\r\n        }\r\n        visible={opened}\r\n      >\r\n        {({ activating, activationError, screenId }) => {\r\n          if (screenId === 'connecting') {\r\n            return (\r\n              <ScreenConnecting\r\n                providerId={activating}\r\n                onCancel={handleResetConnection}\r\n              />\r\n            )\r\n          }\r\n          if (screenId === 'connected') {\r\n            return <ScreenConnected wallet={wallet} />\r\n          }\r\n          if (screenId === 'error') {\r\n            return (\r\n              <ScreenError\r\n                error={activationError}\r\n                onBack={handleResetConnection}\r\n              />\r\n            )\r\n          }\r\n          return <ScreenProviders onActivate={handleActivate} />\r\n        }}\r\n      </AccountPopover>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default AccountModule\r\n"]},"metadata":{},"sourceType":"module"}