{"ast":null,"code":"'use strict';\n\nconst Reader = require('it-reader');\n\nconst log = require('debug')('it-multistream-select:ls');\n\nconst multistream = require('./multistream');\n\nconst handshake = require('it-handshake');\n\nconst lp = require('it-length-prefixed');\n\nconst pipe = require('it-pipe');\n\nmodule.exports = async stream => {\n  const {\n    reader,\n    writer,\n    rest,\n    stream: shakeStream\n  } = handshake(stream);\n  log('write \"ls\"');\n  multistream.write(writer, 'ls');\n  rest(); // Next message from remote will be (e.g. for 2 protocols):\n  // <varint-msg-len><varint-proto-name-len><proto-name>\\n<varint-proto-name-len><proto-name>\\n\n\n  const res = await multistream.read(reader); // After reading response we have:\n  // <varint-proto-name-len><proto-name>\\n<varint-proto-name-len><proto-name>\\n\n\n  const protocolsReader = Reader([res]);\n  const protocols = []; // Decode each of the protocols from the reader\n\n  await pipe(protocolsReader, lp.decode(), async source => {\n    for await (const protocol of source) {\n      // Remove the newline\n      protocols.push(protocol.shallowSlice(0, -1).toString());\n    }\n  });\n  return {\n    stream: shakeStream,\n    protocols\n  };\n};","map":null,"metadata":{},"sourceType":"script"}