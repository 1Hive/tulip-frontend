{"ast":null,"code":"// Copyright (c) 2015-2017 David M. Lee, II\n'use strict';\n/**\n * Local reference to TimeoutError\n * @private\n */\n\nvar TimeoutError;\n/**\n * Rejects a promise with a {@link TimeoutError} if it does not settle within\n * the specified timeout.\n *\n * @param {Promise} promise The promise.\n * @param {number} timeoutMillis Number of milliseconds to wait on settling.\n * @returns {Promise} Either resolves/rejects with `promise`, or rejects with\n *                   `TimeoutError`, whichever settles first.\n */\n\nvar timeout = module.exports.timeout = function (promise, timeoutMillis) {\n  var error = new TimeoutError(),\n      timeout;\n  return Promise.race([promise, new Promise(function (resolve, reject) {\n    timeout = setTimeout(function () {\n      reject(error);\n    }, timeoutMillis);\n  })]).then(function (v) {\n    clearTimeout(timeout);\n    return v;\n  }, function (err) {\n    clearTimeout(timeout);\n    throw err;\n  });\n};\n/**\n * Exception indicating that the timeout expired.\n */\n\n\nTimeoutError = module.exports.TimeoutError = function () {\n  Error.call(this);\n  this.stack = Error().stack;\n  this.message = 'Timeout';\n};\n\nTimeoutError.prototype = Object.create(Error.prototype);\nTimeoutError.prototype.name = \"TimeoutError\";","map":null,"metadata":{},"sourceType":"script"}