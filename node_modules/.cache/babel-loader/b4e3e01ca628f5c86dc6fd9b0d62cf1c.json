{"ast":null,"code":"'use strict';\n\nvar throttle = require('lodash.throttle');\n\nexports = module.exports = TimeCache;\n\nfunction TimeCache(options) {\n  var _this = this;\n\n  if (!(this instanceof TimeCache)) {\n    return new TimeCache(options);\n  }\n\n  options = options || {};\n  var validity = options.validity || 30; // seconds\n\n  var entries = new Map();\n  var sweep = throttle(function () {\n    entries.forEach(function (entry, key) {\n      var v = entry.validity || validity;\n      var delta = getTimeElapsed(entry.timestamp);\n\n      if (delta > v) {\n        entries.delete(key);\n      }\n    });\n  }, 200);\n\n  this.put = function (key, value, validity) {\n    if (!_this.has(key)) {\n      entries.set(key, {\n        value: value,\n        timestamp: new Date(),\n        validity: validity\n      });\n    }\n\n    sweep();\n  };\n\n  this.get = function (key) {\n    if (entries.has(key)) {\n      return entries.get(key).value;\n    } else {\n      throw new Error('key does not exist');\n    }\n  };\n\n  this.has = function (key) {\n    return entries.has(key);\n  };\n}\n\nfunction getTimeElapsed(prevTime) {\n  var currentTime = new Date();\n  var a = currentTime.getTime() - prevTime.getTime();\n  return Math.floor(a / 1000);\n}","map":null,"metadata":{},"sourceType":"script"}