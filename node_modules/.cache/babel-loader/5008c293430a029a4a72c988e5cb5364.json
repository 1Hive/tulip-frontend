{"ast":null,"code":"'use strict';\n\nvar getTime = require('./time');\n\nfunction Retimer(callback, timeout, args) {\n  var that = this;\n  this._started = getTime();\n  this._rescheduled = 0;\n  this._scheduled = timeout;\n  this._args = args;\n  this._timer = setTimeout(timerWrapper, timeout);\n\n  function timerWrapper() {\n    if (that._rescheduled > 0) {\n      that._scheduled = that._rescheduled - (getTime() - that._started);\n      that._timer = setTimeout(timerWrapper, that._scheduled);\n      that._rescheduled = 0;\n    } else {\n      callback.apply(null, that._args);\n    }\n  }\n}\n\nRetimer.prototype.reschedule = function (timeout) {\n  var now = getTime();\n\n  if (now + timeout - (this._started + this._scheduled) < 0) {\n    return false;\n  } else {\n    this._started = now;\n    this._rescheduled = timeout;\n    return true;\n  }\n};\n\nRetimer.prototype.clear = function () {\n  clearTimeout(this._timer);\n};\n\nfunction retimer() {\n  if (typeof arguments[0] !== 'function') {\n    throw new Error('callback needed');\n  }\n\n  if (typeof arguments[1] !== 'number') {\n    throw new Error('timeout needed');\n  }\n\n  var args;\n\n  if (arguments.length > 0) {\n    args = new Array(arguments.length - 2);\n\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i + 2];\n    }\n  }\n\n  return new Retimer(arguments[0], arguments[1], args);\n}\n\nmodule.exports = retimer;","map":null,"metadata":{},"sourceType":"script"}