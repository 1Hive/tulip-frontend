{"ast":null,"code":"var _taggedTemplateLiteral = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/taggedTemplateLiteral\");\n\nvar _regeneratorRuntime = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _templateObject;\n\nvar pageResults = require('graph-results-pager');\n\nvar ws = require('isomorphic-ws');\n\nvar _require = require('subscriptions-transport-ws'),\n    SubscriptionClient = _require.SubscriptionClient;\n\nvar _require2 = require('graphql-request'),\n    gql = _require2.gql;\n\nvar _require3 = require('./../constants'),\n    graphAPIEndpoints = _require3.graphAPIEndpoints,\n    graphWSEndpoints = _require3.graphWSEndpoints,\n    sushiAddress = _require3.sushiAddress;\n\nvar _require4 = require('./../utils'),\n    timestampToBlock = _require4.timestampToBlock;\n\nvar _require5 = require('./exchange'),\n    ethPrice = _require5.ethPrice;\n\nmodule.exports = {\n  priceUSD: function priceUSD() {\n    var _arguments = arguments;\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _ref, _ref$block, block, _ref$timestamp, timestamp;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _ref = _arguments.length > 0 && _arguments[0] !== undefined ? _arguments[0] : {}, _ref$block = _ref.block, block = _ref$block === void 0 ? undefined : _ref$block, _ref$timestamp = _ref.timestamp, timestamp = _ref$timestamp === void 0 ? undefined : _ref$timestamp;\n              _context.next = 3;\n              return ethPrice({\n                block: block,\n                timestamp: timestamp\n              });\n\n            case 3:\n              _context.t0 = _context.sent;\n              _context.next = 6;\n              return module.exports.priceETH({\n                block: block,\n                timestamp: timestamp\n              });\n\n            case 6:\n              _context.t1 = _context.sent;\n              return _context.abrupt(\"return\", _context.t0 * _context.t1);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  priceETH: function priceETH() {\n    var _arguments2 = arguments;\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _ref2, _ref2$block, block, _ref2$timestamp, timestamp;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _ref2 = _arguments2.length > 0 && _arguments2[0] !== undefined ? _arguments2[0] : {}, _ref2$block = _ref2.block, block = _ref2$block === void 0 ? undefined : _ref2$block, _ref2$timestamp = _ref2.timestamp, timestamp = _ref2$timestamp === void 0 ? undefined : _ref2$timestamp;\n              _context2.t0 = pageResults;\n              _context2.t1 = graphAPIEndpoints.exchange;\n              _context2.t2 = {\n                id: \"\\\\\\\"\".concat(sushiAddress, \"\\\\\\\"\")\n              };\n\n              if (!block) {\n                _context2.next = 8;\n                break;\n              }\n\n              _context2.t3 = {\n                number: block\n              };\n              _context2.next = 17;\n              break;\n\n            case 8:\n              if (!timestamp) {\n                _context2.next = 15;\n                break;\n              }\n\n              _context2.next = 11;\n              return timestampToBlock(timestamp);\n\n            case 11:\n              _context2.t5 = _context2.sent;\n              _context2.t4 = {\n                number: _context2.t5\n              };\n              _context2.next = 16;\n              break;\n\n            case 15:\n              _context2.t4 = undefined;\n\n            case 16:\n              _context2.t3 = _context2.t4;\n\n            case 17:\n              _context2.t6 = _context2.t3;\n              _context2.t7 = {\n                where: _context2.t2,\n                block: _context2.t6\n              };\n              _context2.t8 = _priceETH.properties;\n              _context2.t9 = {\n                entity: 'tokens',\n                selection: _context2.t7,\n                properties: _context2.t8\n              };\n              _context2.t10 = {\n                api: _context2.t1,\n                query: _context2.t9\n              };\n              return _context2.abrupt(\"return\", (0, _context2.t0)(_context2.t10).then(function (results) {\n                return _priceETH.callback(results[0]);\n              }).catch(function (err) {\n                return console.error(err);\n              }));\n\n            case 23:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }))();\n  },\n  observePriceETH: function observePriceETH() {\n    var query = gql(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n            subscription {\\n                    token(id: \\\"\", \"\\\") {\\n                        derivedETH\\n                    }\\n        }\"])), sushiAddress);\n    var client = new SubscriptionClient(graphWSEndpoints.exchange, {\n      reconnect: true\n    }, ws);\n    var observable = client.request({\n      query: query\n    });\n    return {\n      subscribe: function subscribe(_ref3) {\n        var _next = _ref3.next,\n            error = _ref3.error,\n            complete = _ref3.complete;\n        return observable.subscribe({\n          next: function next(results) {\n            _next(_priceETH.callback(results.data.token));\n          },\n          error: error,\n          complete: complete\n        });\n      }\n    };\n  }\n};\nvar _priceETH = {\n  properties: ['derivedETH'],\n  callback: function callback(results) {\n    return Number(results.derivedETH);\n  }\n};","map":null,"metadata":{},"sourceType":"script"}