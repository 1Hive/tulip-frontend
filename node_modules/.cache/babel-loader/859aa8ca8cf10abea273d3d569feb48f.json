{"ast":null,"code":"'use strict';\n\nconst mortice = require('mortice');\n\nlet lock;\n\nmodule.exports = repoOwner => {\n  if (lock) {\n    return lock;\n  }\n\n  const mutex = mortice({\n    // ordinarily the main thread would store the read/write lock but\n    // if we are the thread that owns the repo, we can store the lock\n    // on this process even if we are a worker thread\n    singleProcess: repoOwner\n  });\n  lock = {\n    readLock: func => {\n      return async (...args) => {\n        const releaseLock = await mutex.readLock();\n\n        try {\n          return await func.apply(null, args);\n        } finally {\n          releaseLock();\n        }\n      };\n    },\n    writeLock: func => {\n      return async (...args) => {\n        const releaseLock = await mutex.writeLock();\n\n        try {\n          return await func.apply(null, args);\n        } finally {\n          releaseLock();\n        }\n      };\n    }\n  };\n  return lock;\n};","map":null,"metadata":{},"sourceType":"script"}