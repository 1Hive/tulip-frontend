{"ast":null,"code":"'use strict'; // load websocket library if we are not in the browser\n\nvar WebSocket = require('./web-socket');\n\nvar duplex = require('./duplex');\n\nvar wsurl = require('./ws-url');\n\nmodule.exports = function (addr) {\n  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var location = typeof window === 'undefined' ? {} : window.location;\n  var url = wsurl(addr, location);\n  var socket = new WebSocket(url, opts.websocket);\n  var stream = duplex(socket, opts);\n  stream.remoteAddress = url;\n\n  stream.close = function () {\n    return new Promise(function (resolve, reject) {\n      socket.addEventListener('close', resolve);\n      socket.close();\n    });\n  };\n\n  stream.destroy = function () {\n    if (socket.terminate) {\n      socket.terminate();\n    } else {\n      socket.close();\n    }\n  };\n\n  stream.socket = socket;\n  return stream;\n};\n\nmodule.exports.connect = module.exports;","map":null,"metadata":{},"sourceType":"script"}