{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _createForOfIteratorHelper = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _asyncToGenerator = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _defineProperty = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/defineProperty\");\n\nvar _handlers;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createLink = createLink;\nexports.validateLink = validateLink;\nexports.authenticate = authenticate;\n\nvar _constants = require(\"./constants\");\n\nvar _ethereum = _interopRequireDefault(require(\"./blockchains/ethereum\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar findDID = function findDID(did) {\n  return did.match(/(did:(3|muport):[a-zA-Z0-9])\\w+/)[0];\n};\n\nvar handlers = (_handlers = {}, _defineProperty(_handlers, _constants.ADDRESS_TYPES.ethereum, _ethereum.default), _defineProperty(_handlers, _constants.ADDRESS_TYPES.ethereumEOA, _ethereum.default), _defineProperty(_handlers, _constants.ADDRESS_TYPES.erc1271, _ethereum.default), _handlers);\nvar typeDetectors = [_ethereum.default.typeDetector];\n\nfunction detectType(_x) {\n  return _detectType.apply(this, arguments);\n}\n\nfunction _detectType() {\n  _detectType = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(address) {\n    var _iterator, _step, detect, type;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _iterator = _createForOfIteratorHelper(typeDetectors);\n            _context.prev = 1;\n\n            _iterator.s();\n\n          case 3:\n            if ((_step = _iterator.n()).done) {\n              _context.next = 12;\n              break;\n            }\n\n            detect = _step.value;\n            _context.next = 7;\n            return detect(address);\n\n          case 7:\n            type = _context.sent;\n\n            if (!type) {\n              _context.next = 10;\n              break;\n            }\n\n            return _context.abrupt(\"return\", type);\n\n          case 10:\n            _context.next = 3;\n            break;\n\n          case 12:\n            _context.next = 17;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](1);\n\n            _iterator.e(_context.t0);\n\n          case 17:\n            _context.prev = 17;\n\n            _iterator.f();\n\n            return _context.finish(17);\n\n          case 20:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[1, 14, 17, 20]]);\n  }));\n  return _detectType.apply(this, arguments);\n}\n\nfunction createLink(_x2, _x3, _x4) {\n  return _createLink.apply(this, arguments);\n}\n\nfunction _createLink() {\n  _createLink = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(did, address, provider) {\n    var opts,\n        type,\n        produceProof,\n        proof,\n        _args2 = arguments;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            opts = _args2.length > 3 && _args2[3] !== undefined ? _args2[3] : {};\n            _context2.t0 = opts.type;\n\n            if (_context2.t0) {\n              _context2.next = 6;\n              break;\n            }\n\n            _context2.next = 5;\n            return detectType(address);\n\n          case 5:\n            _context2.t0 = _context2.sent;\n\n          case 6:\n            type = _context2.t0;\n\n            if (handlers[type]) {\n              _context2.next = 9;\n              break;\n            }\n\n            throw new Error(\"creating link with type \".concat(type, \", not supported\"));\n\n          case 9:\n            produceProof = handlers[type].createLink;\n            _context2.next = 12;\n            return produceProof(did, address, type, provider, opts);\n\n          case 12:\n            proof = _context2.sent;\n\n            if (!proof) {\n              _context2.next = 17;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", proof);\n\n          case 17:\n            throw new Error(\"Unable to create proof with type \".concat(type));\n\n          case 18:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _createLink.apply(this, arguments);\n}\n\nfunction validateLink(_x5, _x6) {\n  return _validateLink.apply(this, arguments);\n}\n\nfunction _validateLink() {\n  _validateLink = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(proof, did) {\n    var validate, validProof;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            validate = handlers[proof.type].validateLink;\n\n            if (!(typeof validate !== 'function')) {\n              _context3.next = 3;\n              break;\n            }\n\n            throw new Error(\"proof with type \".concat(proof.type, \" not supported\"));\n\n          case 3:\n            _context3.next = 5;\n            return validate(proof);\n\n          case 5:\n            validProof = _context3.sent;\n\n            if (!validProof) {\n              _context3.next = 11;\n              break;\n            }\n\n            validProof.did = findDID(validProof.message);\n            return _context3.abrupt(\"return\", validProof);\n\n          case 11:\n            return _context3.abrupt(\"return\", null);\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _validateLink.apply(this, arguments);\n}\n\nfunction authenticate(_x7, _x8, _x9) {\n  return _authenticate.apply(this, arguments);\n}\n\nfunction _authenticate() {\n  _authenticate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(message, address, provider) {\n    var type;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return detectType(address);\n\n          case 2:\n            type = _context4.sent;\n            return _context4.abrupt(\"return\", handlers[type].authenticate(message, address, provider));\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n  return _authenticate.apply(this, arguments);\n}","map":null,"metadata":{},"sourceType":"script"}