{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DidProvider = void 0;\n\nconst did_jwt_1 = require(\"did-jwt\");\n\nconst rpc_utils_1 = require(\"rpc-utils\");\n\nconst utils_1 = require(\"./utils\");\n\nconst methods = {\n  did_authenticate: ({\n    wallet,\n    origin\n  }) => __awaiter(void 0, void 0, void 0, function* () {\n    yield wallet.authenticate([], {}, origin);\n    return {\n      did: wallet.DID\n    };\n  }),\n  did_createJWS: ({\n    wallet,\n    origin\n  }, params) => __awaiter(void 0, void 0, void 0, function* () {\n    if (!(yield wallet.isAuthenticated([], origin))) {\n      throw new rpc_utils_1.RPCError(0, 'Authentication required');\n    }\n\n    const signer = wallet.getRootSigner(params.pubKeyId);\n    const header = params.protected ? utils_1.toStableObject(params.protected) : undefined;\n    const jws = yield did_jwt_1.createJWS(utils_1.toStableObject(params.payload), signer, header);\n    return {\n      jws\n    };\n  })\n};\n\nclass DidProvider {\n  constructor(wallet) {\n    this._handle = rpc_utils_1.createHandler(methods);\n    this._wallet = wallet;\n  }\n\n  get isDidProvider() {\n    return true;\n  }\n\n  send(msg, origin) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return yield this._handle({\n        origin,\n        wallet: this._wallet\n      }, msg);\n    });\n  }\n\n}\n\nexports.DidProvider = DidProvider;","map":null,"metadata":{},"sourceType":"script"}