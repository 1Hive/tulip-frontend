{"ast":null,"code":"'use strict';\n\nconst {\n  Buffer\n} = require('buffer');\n\nrequire('node-forge/lib/util');\n\nrequire('node-forge/lib/jsbn');\n\nconst forge = require('node-forge/lib/forge');\n\nexports.bigIntegerToUintBase64url = (num, len) => {\n  // Call `.abs()` to convert to unsigned\n  let buf = Buffer.from(num.abs().toByteArray()); // toByteArray converts to big endian\n  // toByteArray() gives us back a signed array, which will include a leading 0\n  // byte if the most significant bit of the number is 1:\n  // https://docs.microsoft.com/en-us/windows/win32/seccertenroll/about-integer\n  // Our number will always be positive so we should remove the leading padding.\n\n  buf = buf[0] === 0 ? buf.slice(1) : buf;\n\n  if (len != null) {\n    if (buf.length > len) throw new Error('byte array longer than desired length');\n    buf = Buffer.concat([Buffer.alloc(len - buf.length), buf]);\n  }\n\n  return exports.bufferToBase64url(buf);\n}; // Convert a Buffer to a base64 encoded string without padding\n// Adapted from https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-41#appendix-C\n\n\nexports.bufferToBase64url = buf => {\n  return buf.toString('base64').split('=')[0] // Remove any trailing '='s\n  .replace(/\\+/g, '-') // 62nd char of encoding\n  .replace(/\\//g, '_'); // 63rd char of encoding\n}; // Convert a base64url encoded string to a BigInteger\n\n\nexports.base64urlToBigInteger = str => {\n  const buf = exports.base64urlToBuffer(str);\n  return new forge.jsbn.BigInteger(buf.toString('hex'), 16);\n};\n\nexports.base64urlToBuffer = (str, len) => {\n  str = (str + '==='.slice((str.length + 3) % 4)).replace(/-/g, '+').replace(/_/g, '/');\n  let buf = Buffer.from(str, 'base64');\n\n  if (len != null) {\n    if (buf.length > len) throw new Error('byte array longer than desired length');\n    buf = Buffer.concat([Buffer.alloc(len - buf.length), buf]);\n  }\n\n  return buf;\n};","map":null,"metadata":{},"sourceType":"script"}