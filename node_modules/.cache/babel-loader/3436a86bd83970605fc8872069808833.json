{"ast":null,"code":"'use strict';\n\nconst {\n  pullAt,\n  cloneDeep\n} = require('lodash');\n\nconst debug = require('debug')('hyperdiff');\n\nconst isPresent = itemIndex => itemIndex !== -1;\n\nfunction GET_INITIAL_STATE() {\n  return {\n    common: [],\n    removed: []\n  };\n}\n\nfunction hasItemWithProps(collection, item, props) {\n  return props.every(prop => item[prop] === collection[prop]);\n}\n\nfunction indexOf(collection, item) {\n  return collection.indexOf(item);\n}\n\nfunction findIndexWithProps(collection, item, props) {\n  return collection.findIndex(function (origItem) {\n    return hasItemWithProps(origItem, item, props);\n  });\n}\n\nfunction determinateCollections(orig, dist) {\n  return {\n    first: orig,\n    second: cloneDeep(dist)\n  };\n}\n\nfunction determinateFindIndex(ids, props) {\n  return props ? findIndexWithProps : indexOf;\n}\n\nfunction hyperdiff(orig, dist, props) {\n  const ids = props ? [].concat(props) : [];\n  const {\n    first,\n    second\n  } = determinateCollections(orig, dist);\n  const findIndex = determinateFindIndex(ids, props);\n  debug('preconditions first=%j second=%j findIndex=%s', first, second, findIndex.name);\n  const results = first.reduce(function (acc, item, index) {\n    const itemIndex = findIndex(second, item, ids);\n    const destination = isPresent(itemIndex) ? 'common' : 'removed';\n    acc[destination].push(item);\n    pullAt(second, itemIndex);\n    debug('index=%s value=%s collection=%s', index, item, destination);\n    return acc;\n  }, GET_INITIAL_STATE());\n  results.added = second;\n  debug('added=%j removed=%j common%j', results.added, results.removed, results.common);\n  return results;\n}\n\nmodule.exports = hyperdiff;","map":null,"metadata":{},"sourceType":"script"}