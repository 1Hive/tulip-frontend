{"ast":null,"code":"'use strict';\n\nconst dagPB = require('ipld-dag-pb');\n\nconst DAGNode = dagPB.DAGNode;\n\nconst multicodec = require('multicodec');\n\nconst Unixfs = require('ipfs-unixfs');\n\nconst {\n  withTimeoutOption\n} = require('../../utils');\n\nconst {\n  Buffer\n} = require('buffer');\n\nmodule.exports = ({\n  ipld,\n  preload\n}) => {\n  return withTimeoutOption(async function _new(template, options) {\n    options = options || {}; // allow options in the template position\n\n    if (template && typeof template !== 'string') {\n      options = template;\n      template = null;\n    }\n\n    let data;\n\n    if (template) {\n      if (template === 'unixfs-dir') {\n        data = new Unixfs('directory').marshal();\n      } else {\n        throw new Error('unknown template');\n      }\n    } else {\n      data = Buffer.alloc(0);\n    }\n\n    const node = new DAGNode(data);\n    const cid = await ipld.put(node, multicodec.DAG_PB, {\n      cidVersion: 0,\n      hashAlg: multicodec.SHA2_256\n    });\n\n    if (options.preload !== false) {\n      preload(cid);\n    }\n\n    return cid;\n  });\n};","map":null,"metadata":{},"sourceType":"script"}