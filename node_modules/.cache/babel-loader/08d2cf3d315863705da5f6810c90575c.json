{"ast":null,"code":"'use strict';\n\nconst utils = require('../../utils');\n\nconst errcode = require('err-code');\n\nmodule.exports = dht => {\n  const log = utils.logger(dht.peerInfo.id, 'rpc:put-value');\n  /**\n   * Process `PutValue` DHT messages.\n   *\n   * @param {PeerInfo} peer\n   * @param {Message} msg\n   * @returns {Promise<Message>}\n   */\n\n  return async function putValue(peer, msg) {\n    const key = msg.key;\n    log('key: %b', key);\n    const record = msg.record;\n\n    if (!record) {\n      const errMsg = `Empty record from: ${peer.id.toB58String()}`;\n      log.error(errMsg);\n      throw errcode(new Error(errMsg), 'ERR_EMPTY_RECORD');\n    }\n\n    await dht._verifyRecordLocally(record);\n    record.timeReceived = new Date();\n    const recordKey = utils.bufferToKey(record.key);\n    await dht.datastore.put(recordKey, record.serialize());\n    return msg;\n  };\n};","map":null,"metadata":{},"sourceType":"script"}