{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = caller;\nexports.call = call;\n\nvar _shortid = require('shortid');\n\nvar _shortid2 = _interopRequireDefault(_shortid);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction caller(funcName, opts) {\n  opts = opts || {};\n  var addListener = opts.addListener || window.addEventListener;\n  var removeListener = opts.removeListener || window.removeEventListener;\n  var postMessage = opts.postMessage || window.postMessage;\n  var targetOrigin = opts.targetOrigin || '*';\n\n  var getMessageData = opts.getMessageData || function (event) {\n    return event.data;\n  };\n\n  return function () {\n    var msg = {\n      sender: 'postmsg-rpc/client',\n      id: (0, _shortid2.default)(),\n      func: funcName,\n      args: Array.from(arguments)\n    };\n    var cancel = void 0;\n    var response = new Promise(function (resolve, reject) {\n      var handler = function handler() {\n        var data = getMessageData.apply(null, arguments);\n        if (!data) return;\n        if (data.sender !== 'postmsg-rpc/server' || data.id !== msg.id) return;\n        removeListener('message', handler);\n\n        if (data.err) {\n          var err = new Error('Unexpected error calling ' + funcName);\n          Object.assign(err, data.err);\n          return reject(err);\n        }\n\n        resolve(data.res);\n      };\n\n      cancel = function cancel() {\n        removeListener('message', handler);\n        var err = new Error('Canceled call to ' + funcName);\n        err.isCanceled = true;\n        reject(err);\n      };\n\n      addListener('message', handler);\n      postMessage(msg, targetOrigin);\n    });\n\n    response.cancel = function () {\n      return cancel();\n    };\n\n    return response;\n  };\n}\n\nfunction call(funcName) {\n  return caller(funcName).apply(null, [].slice.call(arguments, 1));\n}","map":null,"metadata":{},"sourceType":"script"}