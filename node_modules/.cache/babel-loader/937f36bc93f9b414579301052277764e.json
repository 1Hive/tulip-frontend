{"ast":null,"code":"'use strict';\n\nconst {\n  Buffer\n} = require('buffer');\n\nconst Key = require('interface-datastore').Key;\n\nconst debug = require('debug');\n\nconst log = debug('repo:version');\nconst versionKey = new Key('version');\n\nmodule.exports = store => {\n  return {\n    /**\n     * Check if a version file exists.\n     *\n     * @returns {Promise<bool>}\n     */\n    async exists() {\n      // eslint-disable-line require-await\n      return store.has(versionKey);\n    },\n\n    /**\n     * Get the current version.\n     *\n     * @returns {Promise<Integer>}\n     */\n    async get() {\n      const buf = await store.get(versionKey);\n      return parseInt(buf.toString().trim(), 10);\n    },\n\n    /**\n     * Set the version of the repo, writing it to the underlying store.\n     *\n     * @param {number} version\n     * @returns {Promise<void>}\n     */\n    async set(version) {\n      // eslint-disable-line require-await\n      return store.put(versionKey, Buffer.from(String(version)));\n    },\n\n    /**\n     * Check the current version, and returns true if versions matches\n     * @param {number} expected\n     * @returns {boolean}\n     */\n    async check(expected) {\n      const version = await this.get();\n      log('comparing version: %s and %s', version, expected); // Version 6 and 7 are the same\n      // TODO: Clean up the compatibility logic. Repo feature detection would be ideal, or a better version schema\n\n      const compatibleVersion = version === 6 && expected === 7 || expected === 6 && version === 7;\n      return version === expected || compatibleVersion;\n    }\n\n  };\n};","map":null,"metadata":{},"sourceType":"script"}