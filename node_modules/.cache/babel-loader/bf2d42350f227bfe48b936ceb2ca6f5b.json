{"ast":null,"code":"import { getPancakeProfileAddress, getPancakeRabbitsAddress } from 'utils/addressHelpers';\nimport pancakeProfileAbi from 'config/abi/pancakeProfile.json';\nimport pancakeRabbitsAbi from 'config/abi/pancakeRabbits.json';\nimport { getContract } from 'utils/web3';\nimport { getTeam } from 'state/teams/helpers';\nimport nfts from 'config/constants/nfts';\nimport { transformProfileResponse } from './helpers';\nconst profileContract = getContract(pancakeProfileAbi, getPancakeProfileAddress());\nconst rabbitContract = getContract(pancakeRabbitsAbi, getPancakeRabbitsAddress());\nconst profileApi = process.env.REACT_APP_API_PROFILE;\n\nconst getUsername = async address => {\n  try {\n    const response = await fetch(`${profileApi}/api/users/${address}`);\n\n    if (!response.ok) {\n      return '';\n    }\n\n    const {\n      username = ''\n    } = await response.json();\n    return username;\n  } catch (error) {\n    return '';\n  }\n};\n\nconst getProfile = async address => {\n  try {\n    const hasRegistered = await profileContract.methods.hasRegistered(address).call();\n\n    if (!hasRegistered) {\n      return {\n        hasRegistered,\n        profile: null\n      };\n    }\n\n    const profileResponse = await profileContract.methods.getUserProfile(address).call();\n    const {\n      userId,\n      points,\n      teamId,\n      tokenId,\n      nftAddress,\n      isActive\n    } = transformProfileResponse(profileResponse);\n    const team = await getTeam(teamId);\n    const username = await getUsername(address); // If the profile is not active the tokenId returns 0, which is still a valid token id\n    // so only fetch the nft data if active\n\n    let nft;\n\n    if (isActive) {\n      const bunnyId = await rabbitContract.methods.getBunnyId(tokenId).call();\n      nft = nfts.find(nftItem => nftItem.bunnyId === Number(bunnyId)); // Save the preview image to local storage for the exchange\n\n      localStorage.setItem(`profile_${address}`, JSON.stringify({\n        username,\n        avatar: `https://pancakeswap.finance/images/nfts/${nft.images.sm}`\n      }));\n    }\n\n    const profile = {\n      userId,\n      points,\n      teamId,\n      tokenId,\n      username,\n      nftAddress,\n      isActive,\n      nft,\n      team\n    };\n    return {\n      hasRegistered,\n      profile\n    };\n  } catch (error) {\n    return null;\n  }\n};\n\nexport default getProfile;","map":{"version":3,"sources":["/Users/fabian/Documents/Projects/1hive/tulip-frontend/src/state/profile/getProfile.ts"],"names":["getPancakeProfileAddress","getPancakeRabbitsAddress","pancakeProfileAbi","pancakeRabbitsAbi","getContract","getTeam","nfts","transformProfileResponse","profileContract","rabbitContract","profileApi","process","env","REACT_APP_API_PROFILE","getUsername","address","response","fetch","ok","username","json","error","getProfile","hasRegistered","methods","call","profile","profileResponse","getUserProfile","userId","points","teamId","tokenId","nftAddress","isActive","team","nft","bunnyId","getBunnyId","find","nftItem","Number","localStorage","setItem","JSON","stringify","avatar","images","sm"],"mappings":"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","sourcesContent":["import { getPancakeProfileAddress, getPancakeRabbitsAddress } from 'utils/addressHelpers'\nimport pancakeProfileAbi from 'config/abi/pancakeProfile.json'\nimport pancakeRabbitsAbi from 'config/abi/pancakeRabbits.json'\nimport { Nft } from 'config/constants/types'\nimport { getContract } from 'utils/web3'\nimport { Profile } from 'state/types'\nimport { getTeam } from 'state/teams/helpers'\nimport nfts from 'config/constants/nfts'\nimport { transformProfileResponse } from './helpers'\n\nconst profileContract = getContract(pancakeProfileAbi, getPancakeProfileAddress())\nconst rabbitContract = getContract(pancakeRabbitsAbi, getPancakeRabbitsAddress())\nconst profileApi = process.env.REACT_APP_API_PROFILE\n\nexport interface GetProfileResponse {\n  hasRegistered: boolean\n  profile?: Profile\n}\n\nconst getUsername = async (address: string): Promise<string> => {\n  try {\n    const response = await fetch(`${profileApi}/api/users/${address}`)\n\n    if (!response.ok) {\n      return ''\n    }\n\n    const { username = '' } = await response.json()\n\n    return username\n  } catch (error) {\n    return ''\n  }\n}\n\nconst getProfile = async (address: string): Promise<GetProfileResponse> => {\n  try {\n    const hasRegistered = (await profileContract.methods.hasRegistered(address).call()) as boolean\n\n    if (!hasRegistered) {\n      return { hasRegistered, profile: null }\n    }\n\n    const profileResponse = await profileContract.methods.getUserProfile(address).call()\n    const { userId, points, teamId, tokenId, nftAddress, isActive } = transformProfileResponse(profileResponse)\n    const team = await getTeam(teamId)\n    const username = await getUsername(address)\n\n    // If the profile is not active the tokenId returns 0, which is still a valid token id\n    // so only fetch the nft data if active\n    let nft: Nft\n    if (isActive) {\n      const bunnyId = await rabbitContract.methods.getBunnyId(tokenId).call()\n      nft = nfts.find((nftItem) => nftItem.bunnyId === Number(bunnyId))\n\n      // Save the preview image to local storage for the exchange\n      localStorage.setItem(\n        `profile_${address}`,\n        JSON.stringify({\n          username,\n          avatar: `https://pancakeswap.finance/images/nfts/${nft.images.sm}`,\n        }),\n      )\n    }\n\n    const profile = {\n      userId,\n      points,\n      teamId,\n      tokenId,\n      username,\n      nftAddress,\n      isActive,\n      nft,\n      team,\n    } as Profile\n\n    return { hasRegistered, profile }\n  } catch (error) {\n    return null\n  }\n}\n\nexport default getProfile\n"]},"metadata":{},"sourceType":"module"}