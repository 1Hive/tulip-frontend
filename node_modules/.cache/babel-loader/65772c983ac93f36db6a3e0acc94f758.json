{"ast":null,"code":"'use strict';\n\nconst UnixFS = require('ipfs-unixfs');\n\nconst persist = require('../../utils/persist');\n\nconst {\n  DAGNode\n} = require('ipld-dag-pb');\n\nasync function* bufferImporter(file, source, block, options) {\n  for await (let buffer of source) {\n    yield async () => {\n      options.progress(buffer.length);\n      let unixfs;\n      const opts = { ...options\n      };\n\n      if (options.rawLeaves) {\n        opts.codec = 'raw';\n        opts.cidVersion = 1;\n      } else {\n        unixfs = new UnixFS({\n          type: options.leafType,\n          data: buffer,\n          mtime: file.mtime,\n          mode: file.mode\n        });\n        buffer = new DAGNode(unixfs.marshal()).serialize();\n      }\n\n      return {\n        cid: await persist(buffer, block, opts),\n        unixfs,\n        size: buffer.length\n      };\n    };\n  }\n}\n\nmodule.exports = bufferImporter;","map":null,"metadata":{},"sourceType":"script"}