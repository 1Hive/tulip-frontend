{"ast":null,"code":"'use strict';\n\nconst {\n  Buffer\n} = require('buffer');\n\nconst Message = require('../../message');\n\nconst utils = require('../../utils');\n\nmodule.exports = dht => {\n  const log = utils.logger(dht.peerInfo.id, 'rpc:find-node');\n  /**\n   * Process `FindNode` DHT messages.\n   *\n   * @param {PeerInfo} peer\n   * @param {Message} msg\n   * @returns {Promise<Message>}\n   */\n\n  return async function findNode(peer, msg) {\n    log('start');\n    let closer;\n\n    if (msg.key.equals(dht.peerInfo.id.id)) {\n      closer = [dht.peerInfo];\n    } else {\n      closer = await dht._betterPeersToQuery(msg, peer);\n    }\n\n    const response = new Message(msg.type, Buffer.alloc(0), msg.clusterLevel);\n\n    if (closer.length > 0) {\n      response.closerPeers = closer;\n    } else {\n      log('handle FindNode %s: could not find anything', peer.id.toB58String());\n    }\n\n    return response;\n  };\n};","map":null,"metadata":{},"sourceType":"script"}