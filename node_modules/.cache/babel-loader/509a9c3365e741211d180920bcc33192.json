{"ast":null,"code":"'use strict';\n\nvar _regeneratorRuntime = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar getDefaultConfig = require('../runtime/config-nodejs.js');\n\nvar _require = require('../utils'),\n    withTimeoutOption = _require.withTimeoutOption;\n\nvar log = require('debug')('ipfs:core:config');\n\nmodule.exports = function (_ref) {\n  var repo = _ref.repo;\n  return {\n    get: withTimeoutOption(function (key, options) {\n      if (!options && key && typeof key === 'object') {\n        options = key;\n        key = undefined;\n      }\n\n      return repo.config.get(key, options);\n    }),\n    set: withTimeoutOption(repo.config.set),\n    replace: withTimeoutOption(repo.config.replace),\n    profiles: {\n      apply: withTimeoutOption(applyProfile),\n      list: withTimeoutOption(listProfiles)\n    }\n  };\n\n  function applyProfile(_x) {\n    return _applyProfile.apply(this, arguments);\n  }\n\n  function _applyProfile() {\n    _applyProfile = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(profileName) {\n      var options,\n          dryRun,\n          profile,\n          oldCfg,\n          newCfg,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n              dryRun = options.dryRun;\n              profile = profiles[profileName];\n\n              if (profile) {\n                _context.next = 5;\n                break;\n              }\n\n              throw new Error(\"No profile with name '\".concat(profileName, \"' exists\"));\n\n            case 5:\n              _context.prev = 5;\n              _context.next = 8;\n              return repo.config.getAll(options);\n\n            case 8:\n              oldCfg = _context.sent;\n              newCfg = JSON.parse(JSON.stringify(oldCfg)); // clone\n\n              newCfg = profile.transform(newCfg);\n\n              if (dryRun) {\n                _context.next = 14;\n                break;\n              }\n\n              _context.next = 14;\n              return repo.config.replace(newCfg, options);\n\n            case 14:\n              // Scrub private key from output\n              delete oldCfg.Identity.PrivKey;\n              delete newCfg.Identity.PrivKey;\n              return _context.abrupt(\"return\", {\n                original: oldCfg,\n                updated: newCfg\n              });\n\n            case 19:\n              _context.prev = 19;\n              _context.t0 = _context[\"catch\"](5);\n              log(_context.t0);\n              throw new Error(\"Could not apply profile '\".concat(profileName, \"' to config: \").concat(_context.t0.message));\n\n            case 23:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[5, 19]]);\n    }));\n    return _applyProfile.apply(this, arguments);\n  }\n};\n\nfunction listProfiles(_x2) {\n  return _listProfiles.apply(this, arguments);\n}\n\nfunction _listProfiles() {\n  _listProfiles = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(options) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", Object.keys(profiles).map(function (name) {\n              return {\n                name: name,\n                description: profiles[name].description\n              };\n            }));\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _listProfiles.apply(this, arguments);\n}\n\nvar profiles = {\n  server: {\n    description: 'Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery in local networks.',\n    transform: function transform(config) {\n      config.Discovery.MDNS.Enabled = false;\n      config.Discovery.webRTCStar.Enabled = false;\n      return config;\n    }\n  },\n  'local-discovery': {\n    description: 'Sets default values to fields affected by `server` profile, enables discovery in local networks.',\n    transform: function transform(config) {\n      config.Discovery.MDNS.Enabled = true;\n      config.Discovery.webRTCStar.Enabled = true;\n      return config;\n    }\n  },\n  test: {\n    description: 'Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won\\'t be able to talk to the rest of the network without manual bootstrap.',\n    transform: function transform(config) {\n      var defaultConfig = getDefaultConfig();\n      config.Addresses.API = defaultConfig.Addresses.API ? '/ip4/127.0.0.1/tcp/0' : '';\n      config.Addresses.Gateway = defaultConfig.Addresses.Gateway ? '/ip4/127.0.0.1/tcp/0' : '';\n      config.Addresses.Swarm = defaultConfig.Addresses.Swarm.length ? ['/ip4/127.0.0.1/tcp/0'] : [];\n      config.Bootstrap = [];\n      config.Discovery.MDNS.Enabled = false;\n      config.Discovery.webRTCStar.Enabled = false;\n      return config;\n    }\n  },\n  'default-networking': {\n    description: 'Restores default network settings. Inverse profile of the `test` profile.',\n    transform: function transform(config) {\n      var defaultConfig = getDefaultConfig();\n      config.Addresses.API = defaultConfig.Addresses.API;\n      config.Addresses.Gateway = defaultConfig.Addresses.Gateway;\n      config.Addresses.Swarm = defaultConfig.Addresses.Swarm;\n      config.Bootstrap = defaultConfig.Bootstrap;\n      config.Discovery.MDNS.Enabled = defaultConfig.Discovery.MDNS.Enabled;\n      config.Discovery.webRTCStar.Enabled = defaultConfig.Discovery.webRTCStar.Enabled;\n      return config;\n    }\n  },\n  lowpower: {\n    description: 'Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.',\n    transform: function transform(config) {\n      config.Swarm = config.Swarm || {};\n      config.Swarm.ConnMgr = config.Swarm.ConnMgr || {};\n      config.Swarm.ConnMgr.LowWater = 20;\n      config.Swarm.ConnMgr.HighWater = 40;\n      return config;\n    }\n  },\n  'default-power': {\n    description: 'Inverse of \"lowpower\" profile.',\n    transform: function transform(config) {\n      var defaultConfig = getDefaultConfig();\n      config.Swarm = defaultConfig.Swarm;\n      return config;\n    }\n  }\n};\nmodule.exports.profiles = profiles;","map":null,"metadata":{},"sourceType":"script"}