{"ast":null,"code":"var _regeneratorRuntime = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/fabianmolina/Documents/1hive/tulip-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar base64url = require('base64url');\n\nvar _require = require('did-jwt'),\n    verifyJWT = _require.verifyJWT;\n\nvar encodeSection = function encodeSection(data) {\n  return base64url.encode(JSON.stringify(data));\n};\n\nvar TYPE = '3ID';\nvar JWT_HEADER = encodeSection({\n  typ: 'JWT',\n  alg: 'ES256K'\n});\n\nvar OdbIdentityProvider = /*#__PURE__*/function () {\n  \"use strict\";\n\n  function OdbIdentityProvider(_ref) {\n    var threeId = _ref.threeId;\n\n    _classCallCheck(this, OdbIdentityProvider);\n\n    // super(options)\n    this.threeId = threeId;\n  }\n\n  _createClass(OdbIdentityProvider, [{\n    key: \"getId\",\n    value: function () {\n      var _getId = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2) {\n        var space;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                space = _ref2.space;\n\n                if (!space) {\n                  _context.next = 5;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", this.threeId.getSubDID(space));\n\n              case 5:\n                return _context.abrupt(\"return\", this.threeId.DID);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getId(_x) {\n        return _getId.apply(this, arguments);\n      }\n\n      return getId;\n    }()\n  }, {\n    key: \"signIdentity\",\n    value: function () {\n      var _signIdentity = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data, _ref3) {\n        var space, payload, opts;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                space = _ref3.space;\n                payload = {\n                  iat: null,\n                  data: data\n                };\n                opts = !space ? {\n                  use3ID: true\n                } : {\n                  space: space\n                };\n                _context2.next = 5;\n                return this.threeId.signJWT(payload, opts);\n\n              case 5:\n                return _context2.abrupt(\"return\", _context2.sent.split('.')[2]);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function signIdentity(_x2, _x3) {\n        return _signIdentity.apply(this, arguments);\n      }\n\n      return signIdentity;\n    }()\n  }], [{\n    key: \"type\",\n    get: function get() {\n      return '3ID';\n    }\n  }, {\n    key: \"setDidResolver\",\n    value: function () {\n      var _setDidResolver = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(resolver) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this._resolver = resolver;\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function setDidResolver(_x4) {\n        return _setDidResolver.apply(this, arguments);\n      }\n\n      return setDidResolver;\n    }()\n  }, {\n    key: \"verifyIdentity\",\n    value: function () {\n      var _verifyIdentity = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(identity) {\n        var payload, jwt;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (this._resolver) {\n                  _context4.next = 2;\n                  break;\n                }\n\n                throw new Error('The DID resolver must first be set with setDidResolver()');\n\n              case 2:\n                payload = encodeSection({\n                  iat: null,\n                  data: identity.publicKey + identity.signatures.id,\n                  iss: identity.id\n                });\n                jwt = \"\".concat(JWT_HEADER, \".\").concat(payload, \".\").concat(identity.signatures.publicKey);\n                _context4.prev = 4;\n                _context4.next = 7;\n                return verifyJWT(jwt, {\n                  auth: true,\n                  resolver: this._resolver\n                });\n\n              case 7:\n                _context4.next = 12;\n                break;\n\n              case 9:\n                _context4.prev = 9;\n                _context4.t0 = _context4[\"catch\"](4);\n                return _context4.abrupt(\"return\", false);\n\n              case 12:\n                return _context4.abrupt(\"return\", true);\n\n              case 13:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[4, 9]]);\n      }));\n\n      function verifyIdentity(_x5) {\n        return _verifyIdentity.apply(this, arguments);\n      }\n\n      return verifyIdentity;\n    }()\n  }]);\n\n  return OdbIdentityProvider;\n}();\n\nmodule.exports = OdbIdentityProvider;","map":null,"metadata":{},"sourceType":"script"}