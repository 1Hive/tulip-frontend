{"ast":null,"code":"const Fifo = require('fast-fifo');\n\nconst defer = require('p-defer');\n\nmodule.exports = class PFifo {\n  constructor() {\n    this._buffer = new Fifo();\n    this._waitingConsumers = new Fifo();\n  }\n\n  push(chunk) {\n    const {\n      promise,\n      resolve\n    } = defer();\n\n    this._buffer.push({\n      chunk,\n      resolve\n    });\n\n    this._consume();\n\n    return promise;\n  }\n\n  _consume() {\n    while (!this._waitingConsumers.isEmpty() && !this._buffer.isEmpty()) {\n      const nextConsumer = this._waitingConsumers.shift();\n\n      const nextChunk = this._buffer.shift();\n\n      nextConsumer.resolve(nextChunk.chunk);\n      nextChunk.resolve();\n    }\n  }\n\n  shift() {\n    const {\n      promise,\n      resolve\n    } = defer();\n\n    this._waitingConsumers.push({\n      resolve\n    });\n\n    this._consume();\n\n    return promise;\n  }\n\n  isEmpty() {\n    return this._buffer.isEmpty();\n  }\n\n};","map":null,"metadata":{},"sourceType":"script"}