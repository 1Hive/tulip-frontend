{"ast":null,"code":"'use strict';\n\nconst PeerId = require('peer-id');\n\nconst PeerInfo = require('peer-info');\n\nconst multiaddr = require('multiaddr');\n\nconst mafmt = require('mafmt');\n\nconst {\n  EventEmitter\n} = require('events');\n\nconst debug = require('debug');\n\nconst log = debug('libp2p:bootstrap');\nlog.error = debug('libp2p:bootstrap:error');\n/**\n * Emits 'peer' events on a regular interval for each peer in the provided list.\n */\n\nclass Bootstrap extends EventEmitter {\n  /**\n   * Constructs a new Bootstrap.\n   *\n   * @param {Object} options\n   * @param {Array<string>} options.list - the list of peer addresses in multi-address format\n   * @param {number} [options.interval] - the interval between emitting addresses in milliseconds (default: 10000)\n   *\n   */\n  constructor(options = {}) {\n    if (!options.list || !options.list.length) {\n      throw new Error('Bootstrap requires a list of peer addresses');\n    }\n\n    super();\n    this._list = options.list;\n    this._interval = options.interval || 10000;\n    this._timer = null;\n  }\n  /**\n   * Start emitting events.\n   */\n\n\n  start() {\n    if (this._timer) {\n      return;\n    }\n\n    this._timer = setInterval(() => this._discoverBootstrapPeers(), this._interval);\n\n    this._discoverBootstrapPeers();\n  }\n  /**\n   * Emit each address in the list as a PeerInfo.\n   */\n\n\n  _discoverBootstrapPeers() {\n    this._list.forEach(async candidate => {\n      if (!mafmt.P2P.matches(candidate)) {\n        return log.error('Invalid multiaddr');\n      }\n\n      const ma = multiaddr(candidate);\n      const peerId = PeerId.createFromB58String(ma.getPeerId());\n\n      try {\n        const peerInfo = await PeerInfo.create(peerId);\n        peerInfo.multiaddrs.add(ma);\n        this.emit('peer', peerInfo);\n      } catch (err) {\n        log.error('Invalid bootstrap peer id', err);\n      }\n    });\n  }\n  /**\n   * Stop emitting events.\n   */\n\n\n  stop() {\n    if (this._timer) {\n      clearInterval(this._timer);\n      this._timer = null;\n    }\n  }\n\n}\n\nexports = module.exports = Bootstrap;\nexports.tag = 'bootstrap';","map":null,"metadata":{},"sourceType":"script"}